<!doctype html><html lang="pt-BR" dir="ltr"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Construindo uma API RESTful com Laravel - Parte 1</title><meta name="description" content="Web development, front end stuff, tutorials for beginners and more by Rafaell Lycan! "><meta name="google-site-verification" content="epFgX0s_0RM3CdjwFcsewfXzPov2g8s9ZBOLyaIUH-o"/><meta name="robots" content="index, follow"><meta name="HandheldFriendly" content="True" /><meta name="MobileOptimized" content="320" /><meta name="mobile-web-app-capable" content="yes"><link rel="canonical" href="http://localhost:4000/2015/construindo-restful-api-laravel-parte-1/"><link rel="alternate" type="application/rss+xml" title="Hi there, I'm Rafaell" href="http://feeds.feedburner.com/MikeFowler" /><link rel="shortcut icon" href="/assets/img/icons/favicon.ico" type="image/x-icon" /><link rel="author" href="https://plus.google.com/+https://plus.google.com/+RafaellLycan?rel=author"><link rel='dns-prefetch' href='//ajax.googleapis.com' /><link rel='dns-prefetch' href='//fonts.googleapis.com' /><link rel='dns-prefetch' href='//use.fontawesome.com' /><link rel='dns-prefetch' href='//s.gravatar.com' /><link rel='dns-prefetch' href='//s2.getsmartlook.com'><link rel='dns-prefetch' href='//rec.getsmartlook.com'><link rel='preconnect' href='//fonts.googleapis.com' crossorigin /><link rel='preconnect' href='//fonts.gstatic.com' crossorigin><link rel='preconnect' href='//s2.getsmartlook.com' crossorigin><link rel='preconnect' href='//rec.getsmartlook.com' crossorigin> <meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@RafaellLycan" /><meta name="twitter:title" content="Construindo uma API RESTful com Laravel - Parte 1" /><meta name="twitter:description" content="Web development, front end stuff, tutorials for beginners and more by Rafaell Lycan! " /><meta property="twitter:image:src" content="http://localhost:4000assets/img/posts/laravel-api.jpg"> <meta property="og:title" content="Construindo uma API RESTful com Laravel - Parte 1"><meta property="og:url" content="http://localhost:4000/2015/construindo-restful-api-laravel-parte-1/"><meta property="og:description" content="Web development, front end stuff, tutorials for beginners and more by Rafaell Lycan! "><meta property="og:image" content="http://localhost:4000assets/img/posts/laravel-api.jpg"><meta property="og:type" content="article"><meta property="og:site_name" content="Hi there, I'm Rafaell"><link rel="manifest" href="/manifest.json"><link rel="apple-touch-icon" href="/assets/img/icon-96x96.png"><link rel="icon" sizes="192x192" href="/assets/img/icon-192x192.png"><link rel="shortcut icon" href="/assets/img/icon-192x192.png"><style> @charset "UTF-8"; /** Variables */ /** Colors */ /* * It returns the current percent of a context on a reference using pixels * Thanks Ethan Marcotte */ /* * It returns flexible value using 'target / context' formula. * Returns 'rem' as format. */ /* Breakpoint mixin */ /* * It create the current percent of a context on a reference using pixels * Thanks Ethan Marcotte */ /*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */ /* Document ========================================================================== */ /** 1. Change the default font family in all browsers (opinionated). 2. Correct the line height in all browsers. 3. Prevent adjustments of font size after orientation changes in IE on Windows Phone and in iOS. */ html { font-family: sans-serif; /* 1 */ line-height: 1.15; /* 2 */ -ms-text-size-adjust: 100%; /* 3 */ -webkit-text-size-adjust: 100%; /* 3 */ } /* Sections ========================================================================== */ /** Remove the margin in all browsers (opinionated). */ body { margin: 0; } /** Add the correct display in IE 9-. */ article, aside, footer, header, nav, section { display: block; } /** Correct the font size and margin on `h1` elements within `section` and `article` contexts in Chrome, Firefox, and Safari. */ h1, .h1 { font-size: 2em; margin: 0.67em 0; } /* Grouping content ========================================================================== */ /** Add the correct display in IE 9-. 1. Add the correct display in IE. */ figcaption, figure, main { /* 1 */ display: block; } /** Add the correct margin in IE 8. */ figure { margin: 1em 40px; } /** 1. Add the correct box sizing in Firefox. 2. Show the overflow in Edge and IE. */ hr { box-sizing: content-box; /* 1 */ height: 0; /* 1 */ overflow: visible; /* 2 */ } /** 1. Correct the inheritance and scaling of font size in all browsers. 2. Correct the odd `em` font sizing in all browsers. */ pre { font-family: monospace, monospace; /* 1 */ font-size: 1em; /* 2 */ } /* Text-level semantics ========================================================================== */ /** 1. Remove the gray background on active links in IE 10. 2. Remove gaps in links underline in iOS 8+ and Safari 8+. */ a { background-color: transparent; /* 1 */ -webkit-text-decoration-skip: objects; /* 2 */ } /** Remove the outline on focused links when they are also active or hovered in all browsers (opinionated). */ a:active, a:hover { outline-width: 0; } /** 1. Remove the bottom border in Firefox 39-. 2. Add the correct text decoration in Chrome, Edge, IE, Opera, and Safari. */ abbr[title] { border-bottom: none; /* 1 */ text-decoration: underline; /* 2 */ text-decoration: underline dotted; /* 2 */ } /** Prevent the duplicate application of `bolder` by the next rule in Safari 6. */ b, strong { font-weight: inherit; } /** Add the correct font weight in Chrome, Edge, and Safari. */ b, strong { font-weight: bolder; } /** 1. Correct the inheritance and scaling of font size in all browsers. 2. Correct the odd `em` font sizing in all browsers. */ code, kbd, samp { font-family: monospace, monospace; /* 1 */ font-size: 1em; /* 2 */ } /** Add the correct font style in Android 4.3-. */ dfn { font-style: italic; } /** Add the correct background and color in IE 9-. */ mark { background-color: #ff0; color: #000; } /** Add the correct font size in all browsers. */ small { font-size: 80%; } /** Prevent `sub` and `sup` elements from affecting the line height in all browsers. */ sub, sup { font-size: 75%; line-height: 0; position: relative; vertical-align: baseline; } sub { bottom: -0.25em; } sup { top: -0.5em; } /* Embedded content ========================================================================== */ /** Add the correct display in IE 9-. */ audio, video { display: inline-block; } /** Add the correct display in iOS 4-7. */ audio:not([controls]) { display: none; height: 0; } /** Remove the border on images inside links in IE 10-. */ img { border-style: none; } /** Hide the overflow in IE. */ svg:not(:root) { overflow: hidden; } /* Forms ========================================================================== */ /** 1. Change the font styles in all browsers (opinionated). 2. Remove the margin in Firefox and Safari. */ button, input, optgroup, select, textarea { font-family: sans-serif; /* 1 */ font-size: 100%; /* 1 */ line-height: 1.15; /* 1 */ margin: 0; /* 2 */ } /** Show the overflow in IE. 1. Show the overflow in Edge. */ button, input { /* 1 */ overflow: visible; } /** Remove the inheritance of text transform in Edge, Firefox, and IE. 1. Remove the inheritance of text transform in Firefox. */ button, select { /* 1 */ text-transform: none; } /** 1. Prevent a WebKit bug where (2) destroys native `audio` and `video` controls in Android 4. 2. Correct the inability to style clickable types in iOS and Safari. */ button, html [type="button"], [type="reset"], [type="submit"] { -webkit-appearance: button; /* 2 */ } /** Remove the inner border and padding in Firefox. */ button::-moz-focus-inner, [type="button"]::-moz-focus-inner, [type="reset"]::-moz-focus-inner, [type="submit"]::-moz-focus-inner { border-style: none; padding: 0; } /** Restore the focus styles unset by the previous rule. */ button:-moz-focusring, [type="button"]:-moz-focusring, [type="reset"]:-moz-focusring, [type="submit"]:-moz-focusring { outline: 1px dotted ButtonText; } /** Change the border, margin, and padding in all browsers (opinionated). */ fieldset { border: 1px solid #c0c0c0; margin: 0 2px; padding: 0.35em 0.625em 0.75em; } /** 1. Correct the text wrapping in Edge and IE. 2. Correct the color inheritance from `fieldset` elements in IE. 3. Remove the padding so developers are not caught out when they zero out `fieldset` elements in all browsers. */ legend { box-sizing: border-box; /* 1 */ color: inherit; /* 2 */ display: table; /* 1 */ max-width: 100%; /* 1 */ padding: 0; /* 3 */ white-space: normal; /* 1 */ } /** 1. Add the correct display in IE 9-. 2. Add the correct vertical alignment in Chrome, Firefox, and Opera. */ progress { display: inline-block; /* 1 */ vertical-align: baseline; /* 2 */ } /** Remove the default vertical scrollbar in IE. */ textarea { overflow: auto; } /** 1. Add the correct box sizing in IE 10-. 2. Remove the padding in IE 10-. */ [type="checkbox"], [type="radio"] { box-sizing: border-box; /* 1 */ padding: 0; /* 2 */ } /** Correct the cursor style of increment and decrement buttons in Chrome. */ [type="number"]::-webkit-inner-spin-button, [type="number"]::-webkit-outer-spin-button { height: auto; } /** 1. Correct the odd appearance in Chrome and Safari. 2. Correct the outline style in Safari. */ [type="search"] { -webkit-appearance: textfield; /* 1 */ outline-offset: -2px; /* 2 */ } /** Remove the inner padding and cancel buttons in Chrome and Safari on macOS. */ [type="search"]::-webkit-search-cancel-button, [type="search"]::-webkit-search-decoration { -webkit-appearance: none; } /** 1. Correct the inability to style clickable types in iOS and Safari. 2. Change font properties to `inherit` in Safari. */ ::-webkit-file-upload-button { -webkit-appearance: button; /* 1 */ font: inherit; /* 2 */ } /* Interactive ========================================================================== */ /* Add the correct display in IE 9-. 1. Add the correct display in Edge, IE, and Firefox. */ details, menu { display: block; } /* Add the correct display in all browsers. */ summary { display: list-item; } /* Scripting ========================================================================== */ /** Add the correct display in IE 9-. */ canvas { display: inline-block; } /** Add the correct display in IE. */ template { display: none; } /* Hidden ========================================================================== */ /** Add the correct display in IE 10-. */ [hidden] { display: none; } /** Basic styling */ *, *:before, *:after { box-sizing: border-box; } body { font: 1rem/1.8rem "Merriweather", "PT Serif", Georgia, Cambria, "Times New Roman", Times, serif; letter-spacing: 0.01rem; color: #4f5a63; background: #fff; -webkit-font-smoothing: antialiased; text-rendering: optimizeLegibility; } /** Images */ img { max-width: 100%; vertical-align: middle; border-radius: 2px; } /** Figures */ figure { width: 100%; margin: 0 auto; position: relative; clear: both; outline: 0; box-sizing: border-box; user-select: auto; z-index: 100; } figure > img { display: block; } figcaption { position: relative; width: 100%; left: 0; top: 0; color: rgba(79, 90, 99, 0.6); outline: 0; text-align: center; font-size: 14px; margin: 10px auto 0; } /** Headings */ h1, .h1, h2, .h2, h3, .h3, h4, .h4, h5, h6 { font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; line-height: 1.2em; font-weight: 700; } h1, .h1 { font-size: 3rem; letter-spacing: -2px; } h2, .h2 { font-size: 2.25rem; margin-top: 3rem; letter-spacing: -1px; } h3, .h3 { font-size: 1.875rem; } h4, .h4 { font-size: 1.5rem; } @media only screen and (max-width: 768px) { h1, .h1 { font-size: 2.8rem; } h2, .h2 { font-size: 2.2rem; } } @media only screen and (max-width: 480px) { h1, .h1 { font-size: 1.75rem; } h2, .h2 { font-size: 1.5rem; } h3, .h3 { font-size: 1.3rem; } h4, .h4 { font-size: 1.125rem; } } /** Paragraphs */ p { margin: 0 0 1.875rem; } /** Blockquotes */ blockquote { position: relative; margin: 3.125rem 0; padding: 0 2.5em; font-style: italic; font-size: 1.25rem; color: rgba(79, 90, 99, 0.6); letter-spacing: -.01rem; } blockquote:after, blockquote:before { position: absolute; font-size: 4em; color: rgba(0, 0, 0, 0.6); z-index: -1; font-family: 'Droid Serif', georgia, serif; } blockquote:after { content: "”"; right: 0px; } blockquote:before { content: "“"; left: 0px; } blockquote > :last-child { margin-bottom: 0; } /** Horizontal Reference */ hr { box-sizing: content-box; height: 0; display: block; border: 0; text-align: center; margin-top: 50px; margin-bottom: 50px; } hr:before { content: '...'; display: inline-block; margin-left: .6em; color: rgba(79, 90, 99, 0.4); position: relative; top: -30px; font-size: 1.8rem; letter-spacing: .6em; } @media only screen and (max-width: 768px) { hr { margin-top: 30px; margin-bottom: 30px; font-size: 1.25rem; line-height: 1.4; } } /** Code formatting */ pre, code { font-size: 1em; border-radius: 2px; } code { font-family: "Fira Mono", "monaco", "Consolas", "Lucida Console", monospace; font-size: 1rem; letter-spacing: -0.3px; padding: 1px 5px; white-space: normal; } :not(pre) > code { background: #f5f5f5; margin-right: 0.05em; margin-left: 0.05em; padding-right: 5px; padding-left: 5px; white-space: nowrap; } pre { background: #f5f5f5; line-height: 1.35; overflow-x: auto; margin: 1.875rem 0; white-space: pre; word-wrap: normal; -webkit-overflow-scrolling: touch; } pre > code { border-radius: 2px; color: #3d3e44; display: block; outline: none; overflow-x: auto; padding: 1rem; white-space: inherit; } /** Clearfix */ .clearfix:after { content: ""; display: table; clear: both; } /** Hidden */ .hidden { visibility: hidden; display: none; } /** Default list */ .default-list { list-style-type: none; margin: 0; padding: 0; } /** Image rounded */ .img-rounded { border-radius: 50%; } /** Center */ .center { margin-left: auto; margin-right: auto; } .text-center { text-align: center !important; } .text-light { font-weight: normal; } .text-base-color { color: #0074d9; } /** Links */ a { color: #0074d9; text-decoration: none; transition: all 300ms ease-in-out; } a:hover { color: #0059a6; } a:active, a:hover { text-decoration: underline; outline: 0; } .animate { animation: fade-in-down 600ms; animation-delay: 200ms; } @-webkit-keyframes fade-in-down { 0% { opacity: 0; transform: translateY(-10px); } 100% { opacity: 1; transform: translateY(0); } } @-moz-keyframes fade-in-down { 0% { opacity: 0; transform: translateY(-10px); } 100% { opacity: 1; transform: translateY(0); } } @-ms-keyframes fade-in-down { 0% { opacity: 0; transform: translateY(-10px); } 100% { opacity: 1; transform: translateY(0); } } @-o-keyframes fade-in-down { 0% { opacity: 0; transform: translateY(-10px); } 100% { opacity: 1; transform: translateY(0); } } @keyframes fade-in-down { 0% { opacity: 0; transform: translateY(-10px); } 100% { opacity: 1; transform: translateY(0); } } @-webkit-keyframes fade { 0% { opacity: 0; } 60% { opacity: 0; } 100% { opacity: 1; } } @-moz-keyframes fade { 0% { opacity: 0; } 60% { opacity: 0; } 100% { opacity: 1; } } @-ms-keyframes fade { 0% { opacity: 0; } 60% { opacity: 0; } 100% { opacity: 1; } } @-o-keyframes fade { 0% { opacity: 0; } 60% { opacity: 0; } 100% { opacity: 1; } } @keyframes fade { 0% { opacity: 0; } 60% { opacity: 0; } 100% { opacity: 1; } } .header { width: 100%; margin-bottom: 3.75rem; } .header .author { margin: 0 auto; max-width: 45rem; padding-left: 0; padding-right: 0; border: none; animation: fade 600ms ease; } .header img { min-width: 120px; } .header p { color: inherit; } @media only screen and (max-width: 30rem) { .header p { display: none; } } .nav { position: relative; width: 100%; text-align: center; background-color: #1d2637; font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; } .nav__brand { font-weight: 700; } @media only screen and (min-width: 48rem) { .nav__brand { position: absolute; top: 0; left: 0; } } @media only screen and (min-width: 48rem) { .nav__github { position: absolute; top: 0; right: 0; } } .nav__list { max-width: 45rem; margin: 0 auto; padding: 0; list-style: none; overflow: hidden; animation: fade 600ms ease; } .nav__item { float: left; width: 33.33%; } .nav a { display: block; padding: 0.625rem 1.875rem; font-size: 13px; color: #E2E6E7; text-decoration: none; text-transform: uppercase; letter-spacing: 1.2px; transition: all 300ms ease-in-out; } .nav a:hover { color: #0d8eff; } .nav svg { vertical-align: bottom; width: 32px; height: 32px; fill: #fff; } .main-nav { position: relative; padding: 35px 40px; margin: 0 0 30px 0; } .main-nav.overlay { position: absolute; top: 0; left: 0; right: 0; height: 70px; border: none; } .split-layout__sidebar { position: relative; display: flex; padding: 1.875rem; background: #1d2637; background: url("../svgs/bg-triangles-black.svg"); font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif; color: white; text-align: center; flex-direction: column; align-items: center; justify-content: center; } @media only screen and (min-width: 48rem) { .split-layout__sidebar { position: fixed; width: 40%; height: 100%; left: 0; } } @media only screen and (min-width: 60rem) { .split-layout__sidebar { width: 30%; } } .split-layout__avatar { max-width: 120px; } @media only screen and (max-width: 30rem) { .split-layout__avatar { display: none; } } .split-layout__title { font-size: 1.875rem; font-weight: 300; } .split-layout__subtitle { font-size: 0.875rem; margin-top: 0; text-transform: uppercase; opacity: .4; } @media only screen and (max-width: 30rem) { .split-layout__subtitle { padding-bottom: 2rem; } } .split-layout__description { padding: 1.875rem 0 0; } @media only screen and (max-width: 30rem) { .split-layout__description { display: none; } } .split-layout__content { padding-top: 1.875rem; padding-bottom: 1.875rem; } @media only screen and (min-width: 48rem) { .split-layout__content { margin-left: 40%; width: auto; max-width: 100%; } } @media only screen and (min-width: 60rem) { .split-layout__content { margin-left: 30%; } } .split-layout .nav { position: absolute; bottom: 0; } .split-layout .nav__brand, .split-layout .nav__github { display: none; } .split-layout .section-title { display: none; } .split-layout .post-list:before, .split-layout .post-list:after { display: none; }</style><link rel="stylesheet" href="/assets/css/main.css?1493084291212194000"><body> <main class="wrapper"><nav class="nav" role="navigation" itemtype="http://schema.org/SiteNavigationElement" itemscope> <a class="nav__brand" href="http://localhost:4000" title="Hi there, I'm Rafaell"> Rafaell Lycan </a><ul class="nav__list"><li class="nav__item"> <a href="/articles" class="nav__link" itemprop="url">Articles</a><li class="nav__item"> <a href="/projects/" class="nav__link" itemprop="url">Projects</a><li class="nav__item"> <a href="/about/" class="nav__link" itemprop="url">About</a></ul><a class="nav__github" href="https://github.com/rafaell-lycan" title="GitHub" target="github_profile"> <svg viewBox="0 0 512 512"><path d="M256 70.7c-102.6 0-185.9 83.2-185.9 185.9 0 82.1 53.3 151.8 127.1 176.4 9.3 1.7 12.3-4 12.3-8.9V389.4c-51.7 11.3-62.5-21.9-62.5-21.9 -8.4-21.5-20.6-27.2-20.6-27.2 -16.9-11.5 1.3-11.3 1.3-11.3 18.7 1.3 28.5 19.2 28.5 19.2 16.6 28.4 43.5 20.2 54.1 15.4 1.7-12 6.5-20.2 11.8-24.9 -41.3-4.7-84.7-20.6-84.7-91.9 0-20.3 7.3-36.9 19.2-49.9 -1.9-4.7-8.3-23.6 1.8-49.2 0 0 15.6-5 51.1 19.1 14.8-4.1 30.7-6.2 46.5-6.3 15.8 0.1 31.7 2.1 46.6 6.3 35.5-24 51.1-19.1 51.1-19.1 10.1 25.6 3.8 44.5 1.8 49.2 11.9 13 19.1 29.6 19.1 49.9 0 71.4-43.5 87.1-84.9 91.7 6.7 5.8 12.8 17.1 12.8 34.4 0 24.9 0 44.9 0 51 0 4.9 3 10.7 12.4 8.9 73.8-24.6 127-94.3 127-176.4C441.9 153.9 358.6 70.7 256 70.7z"> </path> </svg> </a></nav><article class="post single" itemscope itemtype="http://schema.org/BlogPosting"><header class="post__header container"><figure class="post__image"> <img src="/assets/img/posts/laravel-api.jpg" alt="Construindo uma API RESTful com Laravel - Parte 1" itemprop="thumbnailUrl"></figure><h1 class="post__title" itemprop="name headline"> Construindo uma API RESTful com Laravel - Parte 1</h1><div class="post__meta"> <time datetime="2015-12-10T00:00:00+01:00" itemprop="datePublished"> Dec 10, 2015 </time> <span class="section-spacing"> 3084 words </span> <span> 17 minutes read </span><ul class="meta-tag__list"><li class="meta-tag__item"> <a href="/tags/#laravel">laravel</a><li class="meta-tag__item"> <a href="/tags/#php">php</a></ul></div><div class="post__meta__divider"></div></header><section class="post__content container"><p>Primeiramente, quero deixar claro que não vou me aprofundar muito em padrões de projeto nem otimizações. O foco aqui é resolver pequenos problemas que tive e que gostaria de compartilhar com vocês, mesmo que existam materiais em inglês com mais detalhamentos, etc.<p>Se você já entende bem os conceitos de como o Laravel funciona, como utilizar o <code class="highlighter-rouge">Route</code> de uma forma mais organizada, com <strong>grupos</strong>, <strong>middlewares</strong>, tipos de <code class="highlighter-rouge">response</code> como <strong>json</strong>, proteção contra <a href="https://en.wikipedia.org/wiki/Cross-site_request_forgery">CSRF</a> e <a href="https://en.wikipedia.org/wiki/Cross-origin_resource_sharing">CORS</a>, talvez esse post não seja destinado a você.<p><strong><em>Mas sinta-se a vontade para me dar feedback de onde posso melhorar.</em></strong><h2 id="objetivo">Objetivo</h2><p>Construir uma API RESTful para armazenar vagas de emprego cadastradas por uma empresa. Simples não?<p>Vamos a um Roadmap do que irei abordar nesta série:<ul><li><a href="#instalao">Instalação e configuração do Laravel</a><li><a href="#http-e-o-restful">HTTP e RESTful</a><li><a href="#models-e-migrations">Models e Migrations</a><li>Controllers e Rotas<li>Middlewares<li>Autenticação e Sessão<li>Validações e tratamento de erros<li>Controle de cache com Redis</ul><p>Se der tempo <del>e coragem</del>, eu posso colocar testes também.<h2 id="instalação">Instalação</h2><p>Vamos utilizar o <a href="https://getcomposer.org/">Composer</a> para criar nosso novo projeto, nada de clonar o repositório nem nada do tipo.<figure class="highlight"><pre><code class="language-text" data-lang="text">composer create-project laravel/laravel laravel-api</code></pre></figure><p>Quando a instalação terminar, vá ate a pasta criada e abra em seu editor de preferência.<p>Existe uma pequena coisa que precisamos resolver antes de começarmos a desenvolver nosso serviço RESTful, e se não resolvermos isso logo após a instalação, isso vai nos empacar no meio do desenvolvimento e provavelmente não vamos achar isso legal.<p>Por padrão, a partir da versão 5, o Laravel usa por padrão um middleware para previnir CSRF. Porem, não estamos construindo websites, mas sim uma API, o que perde faz esse middleware perder completamente o sentido em nosso projeto.<p>Para remove-lo, e para fazer isso vamos até a pasta <strong>app/Http</strong> e abrir o arquivo <strong>Kernel.php</strong>. Nele, vamos remover a seguinte linha:<figure class="highlight"><pre><code class="language-text" data-lang="text">\App\Http\Middleware\VerifyCsrfToken::class,</code></pre></figure><p>Vamos também remover alguns arquivos inuteis como nossa view default <strong>welcome.blade.php</strong> dentro de <strong>resources/views</strong> e qualquer controller default que a app tenha criado dentro de <strong>app/Http/Controllers</strong>.<p>Vamos ao <strong>setup</strong> da nossa API utilizando o <strong>.env</strong>, recurso adicionado na versão 5 do framework. Vamos renomear o arquivo <code class="highlighter-rouge">.env.example</code> para apenas <code class="highlighter-rouge">.env</code>, e adicionar algumas como banco de dados:<figure class="highlight"><pre><code class="language-text" data-lang="text">APP_ENV=local
APP_DEBUG=true
APP_KEY=6894RPBq2sEylIP3C5XDUnEniIRwreLT

DB_HOST=localhost
DB_DATABASE=laravel
DB_USERNAME=root
DB_PASSWORD=root

CACHE_DRIVER=file
SESSION_DRIVER=file
QUEUE_DRIVER=sync

MAIL_DRIVER=smtp
MAIL_HOST=mailtrap.io
MAIL_PORT=2525
MAIL_USERNAME=null
MAIL_PASSWORD=null
MAIL_ENCRYPTION=null</code></pre></figure><p>’’<p>No caso eu apenas adicionei o usuário <strong>root</strong> do meu <strong>MySQL</strong> e a minha senha praticamente inquebravel.<p>O <code class="highlighter-rouge">APP_KEY</code> normalmente é gerado na instalação, mas caso algo dê errado, você pode executar o comando <code class="highlighter-rouge">php artisan key:generate</code>.<p>Em nosso MySQL vamos apenas precisar criar o banco de dados, todo o resto sera feito através de <a href="https://en.wikipedia.org/wiki/Data_migration">migrations</a>.<p>Acesse seu banco de dados e crie o database <code class="highlighter-rouge">laravel</code>:<figure class="highlight"><pre><code class="language-text" data-lang="text">CREATE DATABASE laravel</code></pre></figure><p>Por ultimo, mas não menos importante, em <code class="highlighter-rouge">/config/app.php</code> vamos alterar o <strong>timezone</strong> da nossa aplicação para <code class="highlighter-rouge">America/Sao_Paulo</code>. Eu particularmente não gosto de utilizar UTC na aplicação, a não ser que seja realmente necessário.<h2 id="http-e-o-restful">HTTP e o RESTful</h2><p>Antes de ir mais além em nível de código, vamos ver rapidamente uma abordagem sobre HTTP e RESTful, porque se vamos falar de APIs, acho válido também citar a base da coisa.<h4 id="porque-restrestful">Porque REST/RESTful?</h4><p>REST é uma maneira simples de realizar e permitir interações entre sistemas independentes que ganhou força nos últimos anos inspirado pelo HTTP.<p>Nossa <em>app</em> utiliza o conteito <strong>RESTful</strong> sob o protocólo <strong>HTTP</strong>, ou seja, utilizando <em>URLs</em>, <em>verbos HTTP</em> e <em>status code</em>.<h4 id="http">HTTP</h4><p>HTTP é o protocolo que nos permite enviar e receber documentos através da web. No conceito do HTTP temos o <strong>servidor</strong> e o <strong>cliente</strong> que em linhas gerais se comunicam através do protocolo através de mensagens de texto, ou bits de texto mesmo que no corpo da mensagem possa existir algum tipo de mídia, tudo isso é transferido através de trocas de mensagens utilizando bits de texto.<h4 id="urls">URLS</h4><p>São as responsáveis por serem os identificadores para obter algum recurso, assim como páginas na web, como a página de contato, artista, entre muitas outras que um site possa ter.<p>Seguindo esse pensamento, cada URL é um tipo de recurso, vamos considerar a nossa aplicação com algumas URLs simples:<figure class="highlight"><pre><code class="language-text" data-lang="text">/jobs               // Returns all jobs
/jobs/add           // Render a form to add a new job
/job/123            // Return the job with ID 123
/companies/123      // Returns the company with ID 123
/companies/123/edit  // Render a form to edit the company with ID 123</code></pre></figure><p>No padrão <em>RESTful</em> utilizamos por convenção nossas URLs (também chamados de <strong><em>endpoint</em></strong>) sempre no plural, indiferente do retorno ser um único registro por conta do ID passado como segundo parâmetro. Recursos são identificadores únicos.<p><strong><em>Mas e se eu precisar de uma action diferente? Salvar, Criar, Atualizar, Deletar?</em></strong><p>Simples meu caro, para isso utilizamos os verbos HTTP.<h4 id="verbos-http">Verbos HTTP</h4><p>A cada requisição realizada, é utilizado um tipo de verbo HTTP no cabeçalho da requisição. Exemplo:<figure class="highlight"><pre><code class="language-text" data-lang="text">GET     /jobs           // Returns all jobs
DELETE  /job/123        // Delete the job with ID 123
POST    /companies      // Create a new company through post data
PUT     /companies/123  // Update a company with ID 123</code></pre></figure><p>Se você cria formulários com HTML, você já deve estar familiarizado com os dois métodos mais importantes do verbo HTTP: <strong>GET</strong> e <strong>POST</strong>. Mas além deles, temos outros métodos também disponíveis que são muito importantes para criarmos uma aplicação <em>RESTful</em> como <em>GET</em>, <em>POST</em>, <em>PUT</em> e <em>DELETE</em>. Ainda existem outros como o <em>OPTIONS</em> e <em>HEAD</em>, mas não quero ir muito a fundo neste assunto.<ul><li><strong>GET</strong> é o método HTTP mais simples. Utilizado toda vez que você clica em um link ou digita uma URL no browser. Uma requisição <em>GET</em> não deve modificar nenhum recurso em seu sistema, ou seja, deve apenas recuperar informações; <br /> <strong>Ex:</strong> Listagem das vagas. <code class="highlighter-rouge">GET /api/jobs</code> <br /><li><strong>POST</strong> é utilizado quando precisamos processar algo no servidor, adicionar informações a um recurso ou criar um novo recurso. Quando enviamos um formulário de cadastro para o servidor, que envia um corpo em seu request a uma URL especifica; <br /> <strong>Ex:</strong> Criação de um Job ou uma Empresa. <code class="highlighter-rouge">POST /api/jobs</code> <br /><li><strong>PUT</strong> é utilizado quando queremos criar ou atualizar um recurso existente através de um <em>endpoint</em> especifico. A grande diferença entre <em>PUT</em> e <em>POST</em> é que além utilizarem <em>endpoints</em> diferentes, o <em>POST</em> utiliza uma URL onde vai ser tratada a informação e o <em>PUT</em> utiliza o <em>endpoint</em> em que a informação será armazenada/atualizada em sí; <br /> <strong>Ex:</strong> Atualizar dados da Empresa ou Job. <code class="highlighter-rouge">PUT /api/jobs/1</code> <br /><li><strong>DELETE</strong> é utilizado quando queremos remover algum recurso passado por uma URL especifica; <br /> <strong>Ex:</strong> Deletar um Job. <code class="highlighter-rouge">DELETE /api/jobs/1</code></ul><h4 id="status-code">Status Code</h4><p>Eu particularmente acho essa parte como uma das mais importantes e também uma das mais discutidas.<p><strong>Status Code / Response Codes</strong> é a forma padrão de informar ao cliente sobre o resultado de uma requisição feita ao servidor. Essas informações ficam contidas nas <strong>headers</strong> das requisições HTTP que por padrão carregam alguns tipos de dados como o <strong>status code</strong>, <strong>encode</strong>, <strong>content type</strong>, etc.<p>Alguns desenvolvedores utilizam convenção de status 200 (OK) para alguns erros de requisição como um registro não encontrado e coisas do tipo, já outros preferem utilizar erros na faixa dos 400 ou 500 para facilitar o tratamento no cliente, mas isso varia muito.<p>O servidor deve retornar o status mais apropriado para cada tipo de requisição. Dessa forma o cliente consegue tratar mais facilmente erros entre outras coisas. O erro mais familitar que a maioria conhece é o 404 (Not Found), ainda assim existem vários outros que podem ser muito úteis para se utilizar em seu serviço.<p>Alguns dos <strong>status code</strong> mais utilizados em uma arquitetura REST:<h4 id="200-ok">200 OK</h4><p>Indica que uma requisição foi feita com sucesso.<h4 id="201-created">201 Created</h4><p>Indica que uma requisição foi feita com sucesso e que um recurso foi criado. Normalmente utilizamos esse padrão de resposta para <strong>POST</strong> e <strong>PUT</strong>.<h4 id="400-bad-request">400 Bad Request</h4><p>Infica que uma requisição não possuí um formato especifico. Normalmente utilizada quando alguma validação de dados não passa, ou quando esta faltando algum dado ou até mesmo um formato errado. Muito comum utilizar como erro de retorno para <strong>POST</strong> e <strong>PUT</strong>.<h4 id="401-unauthorized">401 Unauthorized</h4><p>Indica que o recurso ou <em>endpoint</em> precisa de um requisição autenticada antes de proseguir.<h4 id="404-not-found">404 Not Found</h4><p>Indica que o recurso da requisição não existe. Normalmente utilizado quando um <strong>endpoint</strong> não corresponde com nenhuma rota registrada na aplicação.<h4 id="405-method-not-allowed">405 Method Not Allowed</h4><p>Indica que o método HTTP utilizado não esta disponível para aquele <em>endpoint</em>.<h4 id="409-conflict">409 Conflict</h4><p>Indica que um conflito ocorreu durante a requisição. Por exemplo, isso poderia ocorrer quando você utiliza <strong>PUT</strong> para atualizar o mesmo registro com dados duplicado, pode não ser um exemplo muito bom, mas não tenho nada melhor em mente.<h4 id="422-unprocessable-entity">422 Unprocessable Entity</h4><p>Indica que a request foi realizada e entendida pelo servidor, porem não foi possível proceguir devido a erros no formato/parâmetros informados. Por exemplo, o erro pode ser lançado caso você espere um XML como parâmetro mas ao invés disso o cliente envia um JSON, ou em um caso mais simplificado poreriam ser valores obrigatórios em um JSON que não correspondem com um modelo/validação.<h4 id="500-internal-server-error">500 Internal Server Error</h4><p>Indica uma falha do lado servidor, normalmente utilizamos quando algo inesperado acontece do lado servidor.<p>Em geral, devemos assumir que as respostas HTTP devem ser utilizadas para melhorar o tipo de resposta da nossa aplicação, mas sempre visando o bom senso, tente utilizar da forma correta principalmente quanto aos códigos de erro.<p>Aos que gostam de cachorros, existe um site que mostra todos os HTTP Status Code <a href="http://httpstatusdogs.com/">bem aqui</a>.<h2 id="models-e-migrations">Models e Migrations</h2><p>Nossa App será bem simples, vai consistir em duas models: <strong>Company</strong> que sera referente as empresas(usuários) cadastrados em nossa app, e <strong>Job</strong> referente as vagas cadastradas.<p>Primeiramente vamos criar nosso model <strong>Company</strong>:<figure class="highlight"><pre><code class="language-text" data-lang="text">php artisan make:model Company
php artisan make:model Job</code></pre></figure><figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Company</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="c1">//
</span><span class="p">}</span></code></pre></figure><figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Job</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="c1">//
</span><span class="p">}</span></code></pre></figure><p>Certo, agora vem a parte onde vamos utilizar <strong>migrations</strong>, que funcionam como controle de versão para nosso banco de dados quando precisamos criar/modificar tabelas ou suas propriedades.<p>Para saber mais sobre <strong>migrations</strong> no Laravel, acesse <a href="http://laravel.com/docs/5.1/migrations">este link</a>.<p>Agora vamos pensar em nossos <strong>schemas</strong>. Um Job pertence a uma empresa (Company), ou seja, a empresa pode ter N jobs, logo temos uma relação <strong>1:N</strong>.<p>Quanto aos tipos de dados, vamos ir pelo básico:<ul><li><strong>Company</strong> tem um <em>nome</em>, <em>email</em> para login/login, url para o <em>website</em>, url para o <em>logo</em> e uma <em>senha</em>;<li><strong>Job</strong> possui um <em>titulo</em>, uma <em>descrição</em>, um <em>local</em> de trabalho, se é permitido trabalhar remotamente e o <em>tipo</em> do job.</ul><p>Além é claro que o <strong>Job</strong> esta vinculado a uma <strong>Company</strong>, então baseado nisso vamos criar nossas <em>migrations</em> começando pela nossa tabela <strong>Companies</strong>;<figure class="highlight"><pre><code class="language-text" data-lang="text">php artisan make:migration create_companies_table --create=companies</code></pre></figure><figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CreateCompaniesTable</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**
     * Run the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">'companies'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">'id'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">'name'</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">'email'</span><span class="p">,</span> <span class="mi">60</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">'website'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">'logo'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">'password'</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">softDeletes</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Reverse the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">drop</span><span class="p">(</span><span class="s1">'companies'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure><p>Vamos a explicação básica:<ul><li>Criamos uma migration através de nosso CLI <strong>artisan</strong> para a tabela <strong>companies</strong><li>Adicionamos um <strong>Schema</strong> base restringindo o tamanho de algumas colunas como <em>name</em>, <em>email</em> e <em>password</em>;<li>Informamos que a coluna <em>email</em> sera do tipo <code class="highlighter-rouge">UNIQUE</code>, para não termos logins duplicados em nosso sistema;<li>Também incluimos <strong>timestamps</strong> que nos geram dois <strong>timestamp</strong> <code class="highlighter-rouge">create_at</code> e <code class="highlighter-rouge">update_at</code>, bem como <strong>soft delete</strong> que nos gera um <strong>timestamp</strong> <code class="highlighter-rouge">deleted_at</code>.</ul><p>Para aqueles que ainda não estão familiarizados com o processo de <em>migragions</em> e o <a href="http://laravel.com/docs/5.1/eloquent">Eloquent</a>, ele utiliza essas 3 colunas com o principio de sempre ter uma referencia sobre os dados criados, atualizados e removidos, que no caso não são removidos de fato quando utilizamos <code class="highlighter-rouge">softDeletes()</code>, o <strong>Eloquent</strong> modifica a query caso essa coluna exista na tabela utilizando a clausula <strong>WHERE</strong>, algo como <code class="highlighter-rouge">WHERE delete_at IS NULL</code> na hora de trazer o resultado.<p>Vamos agora criar a migration para nossa tabela <strong>Jobs</strong>, a qual tera uma referencia para a tabela <strong>Companies</strong> através de uma <strong>foreign key</strong>.<figure class="highlight"><pre><code class="language-text" data-lang="text">php artisan make:migration create_jobs_table --create=jobs</code></pre></figure><figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Schema\Blueprint</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Migrations\Migration</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CreateJobsTable</span> <span class="k">extends</span> <span class="nx">Migration</span>
<span class="p">{</span>
    <span class="sd">/**
     * Run the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">up</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">create</span><span class="p">(</span><span class="s1">'jobs'</span><span class="p">,</span> <span class="k">function</span> <span class="p">(</span><span class="nx">Blueprint</span> <span class="nv">$table</span><span class="p">)</span> <span class="p">{</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">increments</span><span class="p">(</span><span class="s1">'id'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">'title'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">longText</span><span class="p">(</span><span class="s1">'description'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">string</span><span class="p">(</span><span class="s1">'local'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">enum</span><span class="p">(</span><span class="s1">'remote'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'yes'</span><span class="p">,</span> <span class="s1">'no'</span><span class="p">]);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">'type'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">integer</span><span class="p">(</span><span class="s1">'company_id'</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">unsigned</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">foreign</span><span class="p">(</span><span class="s1">'company_id'</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">references</span><span class="p">(</span><span class="s1">'id'</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">on</span><span class="p">(</span><span class="s1">'companies'</span><span class="p">)</span>
                <span class="o">-&gt;</span><span class="na">onDelete</span><span class="p">(</span><span class="s1">'cascade'</span><span class="p">);</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">timestamps</span><span class="p">();</span>
            <span class="nv">$table</span><span class="o">-&gt;</span><span class="na">softDeletes</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">}</span>

    <span class="sd">/**
     * Reverse the migrations.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">down</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Schema</span><span class="o">::</span><span class="na">drop</span><span class="p">(</span><span class="s1">'jobs'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure><p>Rapida explicação:<ul><li>Migration através do <strong>artisan CLI</strong>;<li>Adicionamos um <strong>Schema</strong> simples utilizando tipos como <code class="highlighter-rouge">INT</code>, <code class="highlighter-rouge">VARCHAR</code>, <code class="highlighter-rouge">ENUM</code>, <code class="highlighter-rouge">LONGTEXT</code>, etc;<li>Também adicionamos <strong>timestamps</strong> e <strong>softDeletes</strong> pelas mesmas razões da tabela posterior;<li>Adicionamos uma <strong>foreign key</strong> <code class="highlighter-rouge">company_id</code> com a regra <strong>unsigned</strong> para não manter um relacionamento restrito ao criar/modificar as tabelas;<li>Informamos a referencia a tabela <strong>Companies</strong> e utilizamos o <strong>delete cascade</strong> quando o ID referênte for deletado.</ul><p>Chega de explicações chatas, vamos apenas atualizar nossas models:<figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Company</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'name'</span><span class="p">,</span> <span class="s1">'email'</span><span class="p">,</span> <span class="s1">'website'</span><span class="p">,</span> <span class="s1">'logo'</span><span class="p">,</span> <span class="s1">'password'</span><span class="p">];</span>

    <span class="k">protected</span> <span class="nv">$hidden</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'password'</span><span class="p">];</span>

    <span class="k">protected</span> <span class="nv">$dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'deleted_at'</span><span class="p">];</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">jobs</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">hasMany</span><span class="p">(</span><span class="s1">'App\Job'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure><figure class="highlight"><pre><code class="language-php" data-lang="php"><span class="cp">&lt;?php</span>

<span class="k">namespace</span> <span class="nx">App</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">Job</span> <span class="k">extends</span> <span class="nx">Model</span>
<span class="p">{</span>
    <span class="k">protected</span> <span class="nv">$fillable</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'title'</span><span class="p">,</span> <span class="s1">'description'</span><span class="p">,</span> <span class="s1">'local'</span><span class="p">,</span> <span class="s1">'remote'</span><span class="p">,</span> <span class="s1">'type'</span><span class="p">,</span> <span class="s1">'company_id'</span><span class="p">];</span>

    <span class="k">protected</span> <span class="nv">$dates</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'deleted_at'</span><span class="p">];</span>

    <span class="k">function</span> <span class="nf">company</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">belongsTo</span><span class="p">(</span><span class="s1">'App\User'</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure><p>Pronto, agora com nossas <em>models</em> atualizadas, definimos <strong>white lists</strong> através do atributo <code class="highlighter-rouge">$fillable</code>, utilizamos o relacionamento através <code class="highlighter-rouge">belongsTo</code> e <code class="highlighter-rouge">hasMany</code> em métodos específicos para nos trazer a listagem da relação dos models, além de deixamos explicito que estamos utilizando <strong>soft delete</strong> através do atributo <code class="highlighter-rouge">$dates</code>.<p>A nível de teste, você pode criar um simples <strong>seed</strong> para inserir os primeiros dados da nossa <em>app</em>:<figure class="highlight"><pre><code class="language-php" data-lang="php">// CompaniesSeed.php
<span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Seeder</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">CompaniesSeed</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="p">{</span>
    <span class="sd">/**
     * Run the database seeds.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">App\Company</span><span class="o">::</span><span class="na">create</span><span class="p">([</span>
            <span class="s1">'name'</span> <span class="o">=&gt;</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
            <span class="s1">'email'</span> <span class="o">=&gt;</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="s1">'@gmail.com'</span><span class="p">,</span>
            <span class="s1">'password'</span> <span class="o">=&gt;</span> <span class="nx">bcrypt</span><span class="p">(</span><span class="s1">'secret'</span><span class="p">),</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure><figure class="highlight"><pre><code class="language-php" data-lang="php">// JobsSeed.php
<span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Seeder</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">JobsSeed</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="p">{</span>
    <span class="sd">/**
     * Run the database seeds.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">App\Job</span><span class="o">::</span><span class="na">create</span><span class="p">([</span>
            <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
            <span class="s1">'description'</span> <span class="o">=&gt;</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span>
            <span class="s1">'local'</span> <span class="o">=&gt;</span> <span class="s1">'São Paulo / SP'</span><span class="p">,</span>
            <span class="s1">'title'</span> <span class="o">=&gt;</span> <span class="nx">str_random</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
            <span class="s1">'remote'</span> <span class="o">=&gt;</span> <span class="s1">'no'</span><span class="p">,</span>
            <span class="s1">'type'</span> <span class="o">=&gt;</span> <span class="mi">3</span><span class="p">,</span>
            <span class="s1">'company_id'</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span>
        <span class="p">]);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure><figure class="highlight"><pre><code class="language-php" data-lang="php">// DatabaseSeeder.php
<span class="cp">&lt;?php</span>

<span class="k">use</span> <span class="nx">Illuminate\Database\Seeder</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Illuminate\Database\Eloquent\Model</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">DatabaseSeeder</span> <span class="k">extends</span> <span class="nx">Seeder</span>
<span class="p">{</span>
    <span class="sd">/**
     * Run the database seeds.
     *
     * @return void
     */</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">run</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nx">Model</span><span class="o">::</span><span class="na">unguard</span><span class="p">();</span>

        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">(</span><span class="nx">CompaniesSeed</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>
        <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">call</span><span class="p">(</span><span class="nx">JobsSeed</span><span class="o">::</span><span class="na">class</span><span class="p">);</span>

        <span class="nx">Model</span><span class="o">::</span><span class="na">reguard</span><span class="p">();</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure><p>Você pode inclusive testar via o <a href="https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop">REPL</a> do Laravel através do comando <code class="highlighter-rouge">php artisan tinker</code>.<figure class="highlight"><pre><code class="language-text" data-lang="text">var_dump( App\Company::all() );

$company = App\Company::find(1);
var_dump($company-&gt;jobs);</code></pre></figure><p>No proximo artigo desta série, vamos abordar os <em>Controllers</em>, <em>Rotas</em>, tipos e mensagens de <em>erro</em> e retornar valores em JSON.</section><footer class="post__footer"><section class="share"><div class="container"><ul class="share__post-list"><li class="share__post-item" data-hint="Share on Facebook"> <a class="share__icon share__icon--facebook" href="https://facebook.com/sharer.php?u=http://localhost:4000/2015/construindo-restful-api-laravel-parte-1/" target="share-facebook" title="Share on Facebook"> <span class="share__text">Like</span></a> </a><li class="share__post-item" data-hint="Share on Twitter"> <a class="share__icon share__icon--twitter" href="https://twitter.com/intent/tweet?text=Construindo uma API RESTful com Laravel - Parte 1&url=http://localhost:4000/2015/construindo-restful-api-laravel-parte-1/&via=RafaellLycan&related=RafaellLycan" target="share-twitter" title="Share on Twitter"> <span class="share__text">Tweet</span></a> </a><li class="share__post-item" data-hint="Share on Google Plus"> <a class="share__icon share__icon--gplus" href="https://plus.google.com/share?url=http://localhost:4000/2015/construindo-restful-api-laravel-parte-1/" target="share-gplus" title="Share on Google Plus"> <span class="share__text">+1</span></a> </a></ul></div></section><section class="related container"><h3 class="related__title">References</h3><ul class="default-list"><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="https://vimeo.com/17785736" title="Teach a Dog to REST" target="_blank"> <span itemprop="name">Teach a Dog to REST</span> </a><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="http://laravel.com/docs/5.1/migrations" title="Database - Migrations" target="_blank"> <span itemprop="name">Database - Migrations</span> </a><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="http://laravel.com/docs/5.1/eloquent" title="Eloquent - Getting Started" target="_blank"> <span itemprop="name">Eloquent - Getting Started</span> </a><li class="related__mention" itemprop="mentions" itemscope itemtype="https://schema.org/Thing"> <a itemprop="url" href="http://laravel.com/docs/5.1/eloquent-relationships" title="Eloquent - Relationships" target="_blank"> <span itemprop="name">Eloquent - Relationships</span> </a></ul></section><section class="author" itemprop="author"><div class="author__content container" itemscope itemtype="http://schema.org/Person"><div class="author__pic"> <img src="http://gravatar.com/avatar/dd1c977c7a3e384a9cdae3b5ddd9b006?s=150" alt="" itemprop="image" class="img-rounded"></div><div class="author__bio"><h3 class="author__name" itemprop="name">Rafael Almeida</h3><p> A brazilian Front-end Engineer, living in Barcelona. Works with the web, loves photography and beers, and hates seafood. <a href="mailto:" class="email" itemprop="email"></a> <a href="https://twitter.com/RafaellLycan" class="twitter-follow-button" data-show-count="true"></a></div></div></section><a class="next-article " href="/2015/entendendo-flux/" title="Entendendo Flux"> <span class="container"> <span class="next-article__heading">Next article:</span> <span class="next-article__title">Entendendo Flux</span> <span class="next-article__description">Conheça o Flux, a arquitetura do Facebook para o desenvolvimento Front-End. </span> <button class="btn btn--outline">Read more &rarr;</button> </span> </a><section class="comments container"><h3 class="comments__title">Comments</h3><div id="disqus_thread"></div></section><script type="text/javascript"> var disqus_loaded = false; function load_disqus(){ disqus_loaded = true; var disqus_shortname = 'rafaelllycan'; var disqus_title = ''; var disqus_url = '/2015/construindo-restful-api-laravel-parte-1/'; var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true; dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js'; (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq); var ldr = document.getElementById('disqus_loader'); }; window.onscroll = function(e) { if ((window.innerHeight + window.scrollY) >= (document.body.offsetHeight - 600)) { if (!disqus_loaded) load_disqus(); } }; </script> </footer></article></main><footer class="footer" role="contentinfo"><div class="footer__content"> <span class="footer__copy">&copy; 2017 - Rafaell Lycan</span> <span class="footer__description">Made with ♥ using <a href="http://jekyllrb.com/">Jekyll</a> - &lt;/&gt; on <a href="https://github.com/rafaell-lycan" title="Hosted on GitHub">GitHub</a> </span><ul class="footer__social default-list"><li> <a href="#"> <i class="fa fa-twitter"></i> <span class="social-text">Twitter</span> </a><li> <a href="#"> <i class="fa fa-linkedin"></i> <span class="social-text">Linkedin</span> </a><li> <a href="#"> <i class="fa fa-github"></i> <span class="social-text">Github</span> </a></ul></div></footer> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-16383035-5', 'auto'); ga('require', 'displayfeatures'); ga('send', 'pageview'); </script> <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js?1493084291212194000"></script> <script async src="https://use.fontawesome.com/81e129060e.js?1493084291212194000"></script>  <script src="/assets/scripts/main.js?1493084291212194000"></script> <script> 'use strict'; WebFont.load({ google: { families: [ 'Merriweather:300,300i,900,900i', 'Open Sans: 400,700', 'Fira Mono: 400', ] } }); // if ('serviceWorker' in navigator && (window.location.protocol === 'https:' || window.location.hostname === 'localhost')) { // navigator.serviceWorker // .register('/sw.js?1493084291212194000') // .then(function(registration){console.log('Service Worker Registered.')}) // .catch(function(error){console.log('Error during service worker registration:', error)}); // } </script>
